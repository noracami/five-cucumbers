# README

[![Deployed on Zeabur](https://zeabur.com/deployed-on-zeabur-dark.svg)](https://zeabur.com?referralCode=noracami&utm_source=noracami)

## Introduction

This is a web game service for the game "Five Cucumbers".

Integrate with the GAAS(Game As A Service) platform. link: https://lobby.gaas.waterballsa.tw/

## [Rule](./doc/rule.md)

## Class Diagram

> generated by chatgpt: https://chat.openai.com/share/3acfea14-6dce-44a8-bb74-2cb31ef08240

```mermaid
classDiagram
    class Game {
        - players: Player[]
        - deck: Deck
        - currentPlayer: Player
        - winner: Player
        + startGame(): void
        + playRound(): void
        + determineWinner(): Player
    }

    class Player {
        - hand: Card[]
        - cucumbers: int
        + playCard(trick: Trick): Card
        + receiveCards(cards: Card[]): void
        + calculateCucumbers(): int
        + isEliminated(): boolean
    }

    class Card {
        - value: int
        - cucumbers: int
        + getValue(): int
        + getCucumbers(): int
    }

    class Deck {
        - cards: Card[]
        + shuffle(): void
        + dealCards(numPlayers: int): Card[]
    }

    class Trick {
        - cards: Card[]
        - highestCard: Card
        + addCard(card: Card): void
        + getHighestCard(): Card
        + isPlayable(card: Card): boolean
        + determineWinner(): Player
    }

    Game -- Player : contains
    Game -- Deck : contains
    Game -- Trick : contains
    Player -- Card : contains
    Deck -- Card : contains
    Trick -- Card : contains
```

## Integration Requirements

å¤§å¹³å°å‡ºç‰ˆæ•´åˆæ–‡ä»¶

https://waterball.notion.site/v1-1-0-4020a50d26014f829492147af37db06f

### 1. åˆ°å¤§å¹³å°è¨»å†ŠéŠæˆ² âœ”ï¸

<details>
  <summary>â–¶ï¸ example</summary>

```json
// POST /games
// Host: https://api.gaas.waterballsa.tw
// Authorization: Bearer {éŠæˆ²é–‹ç™¼è€…çš„JWT}

{
  "uniqueName": "fivecucumber",
  "displayName": "é»ƒç“œäº”å…„å¼Ÿ",
  "shortDescription": "It is a trick-taking game with the goal of NOT winning the last trick!",
  "rule": "Try to avoid getting cucumbers more than 5, or you are out!",
  "imageUrl": "https://gaas-five-cucumbers.zeabur.app/watermelon.png",
  "minPlayers": 1,
  "maxPlayers": 6,
  "frontEndUrl": "",
  "backEndUrl": "https://gaas-five-cucumbers.zeabur.app/api"
}
```

</details>

### 2. éŠæˆ²å¾Œç«¯å¯¦ä½œã€Œå¿ƒè·³ã€API âœ”ï¸

### 3. éŠæˆ²å¾Œç«¯å¯¦ä½œã€Œé–‹å§‹éŠæˆ²ã€API âœ”ï¸

> è¼¸å…¥ï¼šæˆ¿é–“ IDã€ç©å®¶è³‡è¨Š
> è¼¸å‡ºï¼šéŠæˆ²é€£çµ(æä¾›çµ¦ IFrame é¡¯ç¤ºéŠæˆ²ç•«é¢)
> Detail see below

<details>
  <summary>â–¶ï¸ request</summary>

```json
// POST /games
// Host: {ä½ çš„å¾Œç«¯ä¸»æ©Ÿ}
// Authorization: Bearer {æˆ¿ä¸»çš„Jwt}

{
  "roomId": "room_385abe92e39a3",
  "players": [
    {
      "id": "6497f6f226b40d440b9a90cc",
      "nickname": "æ¿æ©‹é‡‘åŸæ­¦"
    },
    {
      "id": "6498112b26b40d440b9a90ce",
      "nickname": "ä¸‰é‡å½­äºæ™"
    },
    {
      "id": "6499df157fed0c21a4fd0425",
      "nickname": "è˜†æ´²åŠ‰å¾·è¯"
    },
    {
      "id": "649836ed7fed0c21a4fd0423",
      "nickname": "æ°¸å’Œå‘¨æ°å€«"
    }
  ]
}
```

</details>

<details>
  <summary>â–¶ï¸ response</summary>

```json
{
  "url": "https://{ä½ çš„å‰ç«¯ä¸»æ©Ÿ}/games/{gameId}"
}
```

</details>

### 4. å¯¦ä½œ JWT é©—è­‰ âœ”ï¸

> use auth0 SDK to verify jwt
> https://auth0.com/docs/quickstart/backend/rails/interactive

### 5. å‘¼å«å¤§å¹³å° API `GET /users/me` ğŸ“

> é€éå¤§å¹³å°çš„ JWT å–å¾—ç©å®¶è³‡è¨Šï¼ˆä¾‹å¦‚ï¼šæš±ç¨±ã€idï¼‰

### 6. éŠæˆ²å‰ç«¯å¯¦ä½œã€Œé–‹å§‹éŠæˆ²ã€é é¢ ğŸš§

> ç©å®¶æœƒé€é IFrame è¨ªå• `3. é–‹å§‹éŠæˆ²` API å›å‚³çš„ URLï¼ŒåŠ ä¸Š `?jwt={ç©å®¶çš„ JWT}` åƒæ•¸
> éŠæˆ²å¾Œç«¯è—‰ç”± JWT åˆ¤æ–·ç©å®¶èº«ä»½

### 7. éŠæˆ²å¾Œç«¯å¯¦ä½œã€ŒçµæŸéŠæˆ²ã€API âœ”ï¸

> [!IMPORTANT]
> request body must be explicitly empty

<details>
  <summary>â–¶ï¸ request</summary>

```ruby
url = 'https://api.gaas.waterballsa.tw'
token = ANY_OF_GAME_PLAYER_JWT
HTTPX.plugin(:auth).bearer_auth(token).post(url, body: '')
```

</details>

## backlog

1. bind jwt and user info
2. check cookie in iframe

## endpoint

https://gaas-five-cucumbers.zeabur.app/
